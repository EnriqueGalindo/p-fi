{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Ledger</h1>
  <p><a href="/ledger/new">+ Add entry</a></p>

  <table>
    <thead>
      <tr>
        <th>When</th>
        <th>Type</th>
        <th>Amount</th>
        <th>From</th>
        <th>To / Debt</th>
        <th>Category</th>
        <th>Balance</th>
        <th>Note</th>
        <th style="width:48px; text-align:right;">&nbsp;</th>  <!-- Actions -->
      </tr>
    </thead>
    <tbody>
    {% for t in ledger %}
      <tr>
        <td class="muted">{{ t.ts }}</td>
        <td>{{ t.kind }}</td>
        <td>${{ '%.2f'|format(t.amount or 0) }}</td>
        <td>{{ t.from_account or 'â€”' }}</td>
        <td>{{ t.to_account or t.debt_name or 'â€”' }}</td>
        <td>{{ t.category or 'â€”' }}</td>

        <!-- Balance display -->
        <td>
          {% if t.balance_kind == 'account' %}
            {{ t.balance_name }}: ${{ '%.2f'|format(t.balance_after or 0) }}
          {% elif t.balance_kind == 'debt' %}
            {{ t.balance_name }}: ${{ '%.2f'|format(t.balance_after or 0) }}
          {% elif t.balance_kind == 'transfer' %}
            {{ t.balance_name_from }}: ${{ '%.2f'|format(t.balance_after_from or 0) }}
            â†’ {{ t.balance_name_to }}: ${{ '%.2f'|format(t.balance_after_to or 0) }}
          {% else %}
            â€”
          {% endif %}
        </td>

        <td>{{ t.note or '' }}</td>

        <!-- Actions: delete -->
        <td style="text-align:right;">
          {% if t.id %}
          <form method="post"
                action="{{ url_for('ledger.delete_entry', entry_id=t.id) }}"
                onsubmit="return confirm('Delete this entry? This will update balances.');"
                style="display:inline;">
            <button type="submit"
                    title="Delete"
                    style="border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:.3rem .5rem;cursor:pointer">
              ðŸ—‘
            </button>
          </form>
          {% else %}
            <!-- no id to delete -->
            â€”
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% extends "base.html" %}{% block content %}
<div class="card">
  <h1>Review: Missing Routing</h1>
  <p class="muted">{{ showing }}</p>

  <form action="{{ url_for('ledger_upload.save_review') }}" method="post">
    {% if batch %}<input type="hidden" name="batch" value="{{ batch }}"/>{% endif %}

    <table style="width:100%;border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left;">Date</th>
          <th style="text-align:right;">Amount</th>
          <th style="text-align:left;">Type</th>
          <th style="text-align:left;">Category</th>
          <th style="text-align:left;">Note</th>
          <th style="text-align:left;">From</th>
          <th style="text-align:left;">To</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.ts[:10] }}</td>
          <td style="text-align:right;">${{ '%.2f'|format(r.amount|float) }}</td>

          <td>
            <select name="type-{{ r.id }}">
              {% for t in types %}
              <option value="{{ t }}" {% if (r.kind or '') == t %}selected{% endif %}>{{ t }}</option>
              {% endfor %}
            </select>
          </td>

          <td>
            <select name="category-{{ r.id }}">
              <option value=""></option>
              {% for c in categories %}
              <option value="{{ c }}" {% if (r.category or '') == c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
          </td>

          <td>
            <input name="note-{{ r.id }}" value="{{ r.note or '' }}" placeholder="Add a noteâ€¦" style="width:100%;" />
          </td>

          <!-- FROM: accounts only -->
          <td>
            <select name="from-{{ r.id }}">
              <option value=""></option>
              {% for a in account_options %}
              <option value="{{ a }}" {% if (r.from_account or '') == a %}selected{% endif %}>{{ a }}</option>
              {% endfor %}
            </select>
          </td>

          <!-- TO: accounts + debts (debts prefixed as debt::Name) -->
          <td>
            <select name="to-{{ r.id }}">
              <option value=""></option>
              {% for a in account_options %}
              <option value="{{ a }}" {% if (r.to_account or '') == a %}selected{% endif %}>{{ a }}</option>
              {% endfor %}
              {% if debt_options and debt_options|length %}
              <optgroup label="Debts">
                {% for d in debt_options %}
                {% set v = 'debt::' ~ d %}
                <option value="{{ v }}" {% if (r.debt_name or '') == d %}selected{% endif %}>{{ d }}</option>
                {% endfor %}
              </optgroup>
              {% endif %}
            </select>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div style="margin-top:1rem;">
      <button type="submit">Save changes</button>
      <a class="muted" href="{{ url_for('ledger.list_entries') }}" style="margin-left:.5rem;">Back to ledger</a>
    </div>
  </form>
</div>
{% endblock %}

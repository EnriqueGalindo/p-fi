{% extends "base.html" %}{% block content %}
<div class="card">
  <h1>Plan — Step {{ plan.current_step }}</h1>
  <div class="muted">Generated {{ plan.generated_at }}</div>

<div style="margin:.75rem 0 1rem; padding:.75rem; border:1px solid #e5e7eb; border-radius:10px;">
    <div style="font-weight:600; font-size:1.1rem;">{{ step_copy.name }}</div>
    <div class="muted" style="margin-top:.25rem;">{{ step_copy.description }}</div>
    {% if step_copy.requirements and step_copy.requirements|length %}
    <ul style="margin:.5rem 0 0 .9rem;">
        {% for req in step_copy.requirements %}
        <li>{{ req }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

  <p>
    Net monthly income: <b>${{ '%.2f'|format(plan.monthly.income_after_tax) }}</b><br/>
    Required expenses: <b>${{ '%.2f'|format(plan.monthly.required_expenses) }}</b><br/>
    Groceries allowance: <b>${{ '%.2f'|format(plan.monthly.groceries_allowance) }}</b><br/>
    Leftover: <b>${{ '%.2f'|format(plan.monthly.leftover) }}</b>
  </p>

  <table>
    <thead><tr><th>#</th><th>Step</th><th>Status</th><th>Details</th></tr></thead>
    <tbody>
      {% for s in plan.steps %}
      <tr>
        <td>{{ s.id }}</td>
        <td>{{ s.title }}</td>
        <td>
          {% set st = s.status %}
          <span class="{{ 'ok' if st in ['pass'] else ('bad' if st in ['block','blocked'] else 'warn') }}">{{ st }}</span>
        </td>
        <td>
            {% if s.id in [1,3,6] %}
                Target: ${{ '%.2f'|format(s.target_fund) }},
                EF now (cash − 1 mo costs): ${{ '%.2f'|format(s.ef_now) }},
                Save/month: ${{ '%.2f'|format(s.monthly_to_target) }}
            {% elif s.id == 2 and s.debts %}
                <div class="muted" style="margin-bottom:.25rem;">High-interest debts (APR ≥ 10%) — Total: ${{ '%.2f'|format(s.debts_total) }}</div>
                <table style="font-size:.95rem;">
                <thead><tr><th>Name</th><th>Balance</th><th>APR</th><th>Min/mo</th></tr></thead>
                <tbody>
                    {% for d in s.debts %}
                    <tr>
                    <td>{{ d.name }}</td>
                    <td>${{ '%.2f'|format(d.balance) }}</td>
                    <td>{{ '%.2f'|format(d.apr) }}%</td>
                    <td>${{ '%.2f'|format(d.min_payment) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                </table>
            {% elif s.notes %}
                {{ s.notes|join(' • ') }}
            {% else %}
                —
            {% endif %}

        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <p><a href="/plan.json">Download plan JSON</a></p>
</div>
{% endblock %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Make a payment — gmoney rentals</title>

  {% include "rental_tenant/_theme.html" %}
</head>

<body>
  <div class="shell">

    <section class="panel">

      <div class="brand">
        <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="gmoney logo">
        <div>
          <div class="title">gmoney rentals</div>
          <div class="subtitle">Payments</div>
        </div>
      </div>

      <div class="card">
        <h1 style="margin-top:0;">Make a payment</h1>

        <p class="lead">
          Covered month: <b>{{ due_ym }}</b><br>
          Base rent: <b>${{ "%.2f"|format(rent) }}</b><br>
          Late fee: <b>${{ "%.2f"|format(policy.late_fee) }}</b><br>
          Total due now: <b>${{ "%.2f"|format(policy.total_due) }}</b>
        </p>

        {% set has_partial = existing_receipt and (existing_receipt.status and "partial" in existing_receipt.status|lower) %}

        <form method="POST"
            action="{{ url_for('rental_tenant.create_checkout_session') }}"
            style="display:grid; gap:.75rem; max-width:520px;">

        {% if has_partial %}
            <div class="pill" style="width:100%; justify-content:flex-start;">
            Partial payment already received — remaining balance:
            <b style="margin-left:6px;">${{ "%.2f"|format(remaining) }}</b>
            </div>

            <input type="hidden" name="payment_choice" value="remainder">

            <button class="btn" type="submit">
            Pay remaining ${{ "%.2f"|format(remaining) }}
            </button>

            <a class="pill" href="{{ url_for('rental_tenant.tenant_portal') }}" style="width:max-content;">
            ← Back to portal
            </a>

        {% else %}

            {% if policy.allow_partial %}
            <div class="pill" style="width:100%; justify-content:flex-start;">
                You're paying early — choose an option
            </div>

            <label style="display:flex; gap:.6rem; align-items:flex-start;">
                <input type="radio" name="payment_choice" value="half" checked>
                <div>
                <div style="font-weight:900;">Pay half now</div>
                <div class="muted" style="font-size:12px;">
                    ${{ "%.2f"|format(policy.total_due / 2.0) }}
                </div>
                </div>
            </label>

            <label style="display:flex; gap:.6rem; align-items:flex-start;">
                <input type="radio" name="payment_choice" value="full">
                <div>
                <div style="font-weight:900;">Pay full amount</div>
                <div class="muted" style="font-size:12px;">
                    ${{ "%.2f"|format(policy.total_due) }}
                </div>
                </div>
            </label>

            {% else %}
            <div class="muted" style="font-size:12px;">
                Full payment is required right now.
            </div>
            <input type="hidden" name="payment_choice" value="full">
            {% endif %}

            <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn" type="submit">Continue to Stripe</button>
            <a class="pill" href="{{ url_for('rental_tenant.tenant_portal') }}">← Back to portal</a>
            </div>

        {% endif %}
        </form>
      </div>

    </section>

  </div>
</body>
</html>
